#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ“ Validating commit message..."

# è¯»å–æäº¤ä¿¡æ¯
COMMIT_MSG_FILE="$1"
COMMIT_MSG=$(cat "$COMMIT_MSG_FILE")

# Conventional Commits æ­£åˆ™è¡¨è¾¾å¼
# æ ¼å¼: type(scope): description
CONVENTIONAL_REGEX='^(feat|fix|docs|style|refactor|test|chore|build|ci|perf)(\([a-zA-Z0-9\-]+\))?: .{1,50}'

# æ£€æŸ¥æäº¤ä¿¡æ¯é•¿åº¦
if [ ${#COMMIT_MSG} -gt 100 ]; then
  echo "âŒ Commit message is too long (max 100 characters)"
  echo "Current length: ${#COMMIT_MSG}"
  exit 1
fi

# æ£€æŸ¥æ˜¯å¦ç¬¦åˆ Conventional Commits è§„èŒƒ
if ! echo "$COMMIT_MSG" | grep -qE "$CONVENTIONAL_REGEX"; then
  echo "âŒ Commit message does not follow Conventional Commits format"
  echo ""
  echo "Expected format: type(scope): description"
  echo ""
  echo "Types:"
  echo "  feat     - New feature"
  echo "  fix      - Bug fix"
  echo "  docs     - Documentation"
  echo "  style    - Code style/formatting"
  echo "  refactor - Code refactoring"
  echo "  test     - Testing"
  echo "  chore    - Build process or tooling"
  echo "  build    - Build system"
  echo "  ci       - CI configuration"
  echo "  perf     - Performance improvement"
  echo ""
  echo "Examples:"
  echo "  feat(sync): add WebSocket real-time sync"
  echo "  fix(api): handle connection timeout"
  echo "  docs: update installation guide"
  echo "  chore: update dependencies"
  echo ""
  echo "Your message:"
  echo "  $COMMIT_MSG"
  exit 1
fi

echo "âœ… Commit message validation passed"